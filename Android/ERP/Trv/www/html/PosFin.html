<script>
    function limpaCamposPosFin() {
        goDvPesq.style.display = "none";
        document.getElementById("divVenc").innerHTML = "";
        document.getElementById("divAven").innerHTML = "";
        gmPqClie = [];
    }

    function pesquisaClientesInadimplentes() {
        var loTxPesq = document.getElementById("txtPesq");
        var loDvVenc = document.getElementById("divVenc");
        var loDvAven = document.getElementById("divAven");
        var lcSlPesq = goSlPesq.value.toString().trim();
        var lcTxPesq = loTxPesq.value.toString().trim();
        var lcWsHttp = "";

        myApp.showTab("#PosFin");

        if (lcTxPesq == "") { lcWsHttp = pcWsHttp + "pesquisaClientesInadimplentes?lcIdEmpr=TRV&lcIdVend=" + poCnVend.id_vend.toString().trim() + "&lcIdClie:IsNull=True&lcClNome:IsNull=True&lcIdCida:IsNull=True"; }
        else if (lcSlPesq == "id_clie") {

            if (isNaN(lcTxPesq)) {
                myApp.alert("CÓDIGO INVÁLIDO", "ERRO");
                goDvPesq.style.display = "none";
                loDvVenc.innerHTML = "";
                loDvAven.innerHTML = "";

                return false;
            }

            lcWsHttp = pcWsHttp + "pesquisaClientesInadimplentes?lcIdEmpr=TRV&lcIdVend=" + poCnVend.id_vend.toString().trim() + "&lcIdClie=" + lcTxPesq + "&lcClNome:IsNull=True&lcIdCida:IsNull=True";
        }
        else if (lcSlPesq == "cl_nome") { lcWsHttp = pcWsHttp + "pesquisaClientesInadimplentes?lcIdEmpr=TRV&lcIdVend=" + poCnVend.id_vend.toString().trim() + "&lcIdClie:IsNull=True&lcClNome=" + lcTxPesq + "&lcIdCida:IsNull=True"; }
        else if (lcSlPesq == "id_cida") { lcWsHttp = pcWsHttp + "pesquisaClientesInadimplentes?lcIdEmpr=TRV&lcIdVend=" + poCnVend.id_vend.toString().trim() + "&lcIdClie:IsNull=True&lcClNome:IsNull=True&lcIdCida=" + lcTxPesq; }

        myApp.showIndicator();

        $.ajax({
            url: lcWsHttp,
            type: "GET",
            dataType: "jsonp",
            contentType: "application/json; charset=utf-8",

            success: function (lmClInad) {
                try {
                    if (lmClInad.length > 0) {
                        var lcClInad = "";

                        goDvPesq.style.display = "";
                        gnTpVenc = 0;
                        gnTpAven = 0;
                        gmPqClie = lmClInad;

                        lcClInad += "<div class='row no-gutter'>";
                        lcClInad += "<div class='col-auto'><b>CÓDIGO</b></div>";
                        lcClInad += "<div class='col-auto'><b>R. SOCIAL</b></div>";
                        lcClInad += "<div class='col-auto'><b>CIDADE</b></div>";
                        lcClInad += "<div class='col-auto'><b>VENCIDO</b></div>";
                        lcClInad += "<div class='col-auto'><b>A VENCER</b></div>";
                        lcClInad += "</div>";

                        for (var x = 0; x < lmClInad.length; x++) {
                            lcClInad += "<div onclick='pesquisaTitulosEmAberto(" + x + ");' class='row no-gutter'>";
                            lcClInad += "<div id='divIdcl" + x + "' class='col-auto'>" + lmClInad[x].id_clie + "</div>";
                            lcClInad += "<div class='col-auto'>" + lmClInad[x].cl_nome + "</div>";
                            lcClInad += "<div class='col-auto'>" + lmClInad[x].id_cida.trim() + " - " + lmClInad[x].id_esta + "</div>";
                            lcClInad += "<div class='col-auto'>" + brMoney(lmClInad[x].tp_venc) + "</div>";
                            lcClInad += "<div class='col-auto'>" + brMoney(lmClInad[x].tp_aven) + "</div>";
                            lcClInad += "</div>";

                            gnTpVenc += lmClInad[x].tp_venc;
                            gnTpAven += lmClInad[x].tp_aven;
                        }

                        loDvVenc.innerHTML = brMoney(gnTpVenc);
                        loDvAven.innerHTML = brMoney(gnTpAven);

                        $("#divPesq").html(lcClInad).show();
                    }
                    else {
                        myApp.alert("NENHUM CLIENTE INADIMPLENTE ENCONTRADO", "ALERTA");
                        limpaCamposPosFin();
                    }
                }
                catch (loWkErro) {
                    myApp.alert("ERRO AO PESQUISAR CLIENTES INADIMPLENTES", "ERRO");
                    limpaCamposPosFin();
                }

                myApp.hideIndicator();
            },
            error: function () {
                myApp.hideIndicator();
                myApp.alert("ERRO AO PESQUISAR CLIENTES INADIMPLENTES", "ERRO");
                limpaCamposPosFin();
            }
        });
    }

    function limpaCamposTitAbe() {
        goDvTeab.style.display = "none";
        document.getElementById("divCodi").innerHTML = "";
        document.getElementById("divNome").innerHTML = "";
        document.getElementById("divFant").innerHTML = "";
        document.getElementById("divCida").innerHTML = "";
    }

    function pesquisaTitulosEmAberto(lnNrLinh) {
        var lcIdClie = document.getElementById("divIdcl" + lnNrLinh.toString().trim()).innerHTML.trim();

        myApp.showTab("#TitAbe");

        myApp.showIndicator();

        $.ajax({
            url: pcWsHttp + "pesquisaTitulosEmAberto?lcIdEmpr=TRV&lcIdVend=" + poCnVend.id_vend.toString().trim() + "&lcIdClie=" + lcIdClie,
            type: "GET",
            dataType: "jsonp",
            contentType: "application/json; charset=utf-8",

            success: function (lmTiAber) {
                try {
                    var lcTiAber = "";
                    var lnChDevl = 0, lnChLcto = 0, lnToDupl = 0;

                    document.getElementById("divCodi").innerHTML = gmPqClie[lnNrLinh].id_clie;
                    document.getElementById("divNome").innerHTML = gmPqClie[lnNrLinh].cl_nome;
                    document.getElementById("divFant").innerHTML = gmPqClie[lnNrLinh].cl_fant;
                    document.getElementById("divCida").innerHTML = gmPqClie[lnNrLinh].id_cida + " - " + gmPqClie[lnNrLinh].id_esta;
                    document.getElementById("divVlab").innerHTML = brMoney(gmPqClie[lnNrLinh].tp_venc + gmPqClie[lnNrLinh].tp_aven);

                    goDvTeab.style.display = "";

                    lcTiAber += "<div class='row no-gutter'>";
                    lcTiAber += "<div class='col-auto'><b>DUPLICATA</b></div>";
                    lcTiAber += "<div class='col-auto'><b>PARCELA</b></div>";
                    lcTiAber += "<div class='col-auto'><b>DT. EMISSÃO</b></div>";
                    lcTiAber += "<div class='col-auto'><b>DT. VENC.</b></div>";
                    lcTiAber += "<div class='col-auto'><b>DIAS ATRASO</b></div>";
                    lcTiAber += "<div class='col-auto'><b>VL. ABERTO</b></div>";
                    lcTiAber += "</div>";

                    for (var x = 0; x < lmTiAber.length; x++) {
                        lcTiAber += "<div class='row no-gutter'>";
                        lcTiAber += "<div class='col-auto'>" + lmTiAber[x].cr_nume + "</div>";
                        lcTiAber += "<div class='col-auto'>" + lmTiAber[x].cr_parc + "</div>";
                        lcTiAber += "<div class='col-auto'>" + lmTiAber[x].cr_dtem + "</div>";
                        lcTiAber += "<div class='col-auto'>" + escondeDataZerada(lmTiAber[x].cr_dtve) + "</div>";
                        lcTiAber += "<div class='col-auto'>" + escondeNegativos(lmTiAber[x].di_atrs) + "</div>";
                        lcTiAber += "<div class='col-auto'>" + brMoney(lmTiAber[x].vl_aber) + "</div>";
                        lcTiAber += "</div>";

                        if (lmTiAber[x].cr_parc == "CHD") { lnChDevl += lmTiAber[x].vl_aber; }
                        else if (lmTiAber[x].cr_parc == "CHP") { lnChLcto += lmTiAber[x].vl_aber; }
                        else { lnToDupl += lmTiAber[x].vl_aber; }
                    }

                    document.getElementById("divChde").innerHTML = brMoney(lnChDevl);
                    document.getElementById("divCheq").innerHTML = brMoney(lnChLcto);
                    document.getElementById("divDupl").innerHTML = brMoney(lnToDupl);

                    $("#divTeab").html(lcTiAber).show();
                }
                catch (loWkErro) {
                    myApp.alert("ERRO AO PESQUISAR TÍTULOS EM ABERTO", "ERRO");
                    limpaCamposTitAbe();
                }

                myApp.hideIndicator();
            },
            error: function () {
                myApp.hideIndicator();
                myApp.alert("ERRO AO PESQUISAR TÍTULOS EM ABERTO", "ERRO");
                limpaCamposTitAbe();
            }
        });
    }
</script>
<div class="list-block">
    <ul>
        <li>
            <div class="item-content">
                <div class="item-inner">
                    <div class="item-input">
                        <select id="sltPesq" name="sltPesq">
                            <option value="id_clie" selected="selected">CÓDIGO</option>
                            <option value="cl_nome">RAZÃO SOCIAL</option>
                            <option value="id_cida">CIDADE</option>
                        </select>
                    </div>
                </div>
            </div>
        </li>
        <li>
            <div class="item-content">
                <div class="item-inner">
                    <div class="item-input">
                        <input id="txtPesq" type="text" placeholder="DIGITE O TEXTO DA PESQUISA" />
                    </div>
                </div>
            </div>
        </li>
    </ul>
</div>
<a id="ahrPesq" href="#" onclick="pesquisaClientesInadimplentes();" class="button button-fill button-raised">PESQUISAR</a>
<div class="content-block">
    <div class="buttons-row">
        <a href="#PosFin" class="tab-link active button">POSIÇÃO FINANCEIRA</a>
        <a href="#TitAbe" class="tab-link button">TÍTULOS EM ABERTO</a>
    </div>
</div>
<div class="tabs">
    <div id="PosFin" class="tab active">
        <div class="list-block">
            <ul>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">VL. TOTAL VENCIDO</div>
                        <div id="divVenc" style="color: red;" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">VL. TOTAL A VENCER</div>
                        <div id="divAven" style="color: red;" class="item-after"></div>
                    </div>
                </li>
            </ul>
        </div>
        <div id="divPesq" class="content-block"></div>
    </div>
    <div id="TitAbe" class="tab">
        <div class="list-block">
            <ul>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">CÓDIGO</div>
                        <div id="divCodi" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">RAZÃO SOCIAL</div>
                        <div id="divNome" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">NOME FANTASIA</div>
                        <div id="divFant" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">CIDADE</div>
                        <div id="divCida" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">CHEQUES DEVOLVIDOS</div>
                        <div id="divChde" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">CHEQUES EM ABERTO</div>
                        <div id="divCheq" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">DUPLICATAS EM ABERTO</div>
                        <div id="divDupl" class="item-after"></div>
                    </div>
                </li>
                <li class="item-content">
                    <div class="item-inner">
                        <div class="item-title">VL. TOTAL EM ABERTO</div>
                        <div id="divVlab" style="color: red;" class="item-after"></div>
                    </div>
                </li>
            </ul>
        </div>
        <div id="divTeab" class="content-block"></div>
    </div>
</div>
<script>
    var goDvPesq = document.getElementById("divPesq");
    var goDvTeab = document.getElementById("divTeab");
    var goSlPesq = document.getElementById("sltPesq");
    var gnTpVenc = 0, gnTpAven = 0;
    var gmPqClie = [];

    $(document).ready(function () {
        pesquisaClientesInadimplentes();

        OkTecladoAndroid3("txtPesq", "ahrPesq", "ahrPesq");
    });
</script>